<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
# Authentication

This sample demonstrates how to implement **Bearer Token authentication** within an agent configuration. It shows how to intercept requests, validate tokens, extract the user generated by the authentication and pass it to the context.


## Key Components

- `index.ts`: generates an `AgentCard` to require for the Bearer authentication for incoming requests and starts the server with the authentication middleware and user builder.
- `authetication_middleware.ts`: creates the middleware responsible for authentication. It uses Passport to support Bearer token authorization and populates the `user` parameter in the Request object with the plain extracted object.
- `user_builder.ts`: defines the callback for the agent extraction. It expects the user object (populated by the middleware) to contain specific values (`email`, `userName`, `role`) which are used to build the `CustomUser` object.
- `agent_executor.ts`: creates a simple agent executor, to check the authentication status of the user object present in the context, which is expected to be an instance of `CustomUser` in case of successful authentication.


To test the agent:

```bash
npm run agents:authentication-agent
```

The agent will start on `http://localhost:41241`.

Use this tool https://www.jwt.io/ to generate your Json Web Token with the JWT Encoder. 
For a successful authentication the payload data MUST contain these valuese: "email", "userName", "role".

```bash
curl -X POST http://localhost:41241/
    -H "Authorization: Bearer <jwt-token>"
=======
=======
>>>>>>> 2d7da54 (authentication agent WIP)
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJPbmxpbmUgSldUIEJ1aWxkZXIiLCJpYXQiOjE3NjQxNjY0MTYsImV4cCI6MTkyMTkzMjgzNCwiYXVkIjoid3d3LmV4YW1wbGUuY29tIiwic3ViIjoianJvY2tldEBleGFtcGxlLmNvbSIsInVzZXJOYW1lIjoiSm9obm55Iiwicm9sZSI6IlJvY2tldCIsImVtYWlsIjoianJvY2tldEBleGFtcGxlLmNvbSJ9.XH3aiaBW2FPcz7CKYpKCFv3B73qy99HGkYBiWiwg-rk



curl -X POST http://localhost:41241/
    -H "X-A2A-Extensions: https://github.com/a2aproject/a2a-js/src/samples/extensions/v1"
    -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJPbmxpbmUgSldUIEJ1aWxkZXIiLCJpYXQiOjE3NjQxNjY0MTYsImV4cCI6MTkyMTkzMjgzNCwiYXVkIjoid3d3LmV4YW1wbGUuY29tIiwic3ViIjoianJvY2tldEBleGFtcGxlLmNvbSIsInVzZXJOYW1lIjoiSm9obm55Iiwicm9sZSI6IlJvY2tldCIsImVtYWlsIjoianJvY2tldEBleGFtcGxlLmNvbSJ9.XH3aiaBW2FPcz7CKYpKCFv3B73qy99HGkYBiWiwg-rk"
<<<<<<< HEAD
>>>>>>> 5d6508c (authentication agent WIP)
=======
>>>>>>> 2d7da54 (authentication agent WIP)
    -H "Content-Type: application/json"
    -d '{
        "jsonrpc": "2.0",
        "id": 1,
        "method": "message/send",
        "params": {
            "message": {
            "role": "user",
            "parts": [
                {
                "kind": "text",
                "text": "Hello how are you?"
                }
            ],
            "messageId": "9229e770-767c-417b-a0b0-f0741243c589"
            }
        }
<<<<<<< HEAD
<<<<<<< HEAD
    }'
```

Expected response, with successful authentication:
```json
    {
        "jsonrpc":"2.0",
        "id":1,
        "result": {
            "kind":"message",
            "role":"agent",
            "parts":[ {
                "kind":"text",
                "text":"The request is coming from the authenticated user <your-userName>, with email <your-email>  and role <your-role>." 
                }]
            }
    }

```

Expected response, with failed authentication:
```json
    {
        "jsonrpc":"2.0",
        "id":1,
        "result": {
            "kind":"message",
            "role":"agent",
            "parts":[ {
                "kind":"text",
                "text":"The request is not coming from an autheticated user." 
                }]
            }
    }

```
=======
    }'
>>>>>>> 5d6508c (authentication agent WIP)
=======
>>>>>>> 460009d (wip authentication sample)
=======
    }'
>>>>>>> 2d7da54 (authentication agent WIP)
=======
>>>>>>> 9427f36 (wip authentication sample)
